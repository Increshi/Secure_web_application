# events {
#     worker_connections 1024;  # The maximum number of simultaneous connections
# }


# # The main HTTP block
# http {
#     include       /etc/nginx/mime.types;  # Ensure Nginx knows about the types
#     default_type  application/octet-stream;

#     # Disable ETag headers for all responses
#     etag off;

#     # Prevent the site from being framed by any site
#     add_header X-Frame-Options "SAMEORIGIN" always;

#     # Prevent MIME type sniffing
#     add_header X-Content-Type-Options "nosniff" always;

#     server {
#         listen       80;
#         server_name  localhost;

#        # Set the root directory for the frontend files
#         root /usr/share/nginx/html;

#         # Serve the index file
#         index index.html;

#         autoindex off;

#         # Serve dashboard page
#         location /dashboard_page {
#             try_files $uri $uri/ =404;  # Try to serve the file, return 404 if not found
#         }

#         # Handle other pages like login, profile, etc.
#         location /login_page {
#             try_files $uri $uri/ =404;
#         }

#         location /profile_page {
#             try_files $uri $uri/ =404;
#         }

#         location /transfer_page {
#             try_files $uri $uri/ =404;
#         }

#         # Disable directory listing for /images/ directory
#         location /images/ {
#             autoindex off;  # Prevent file listing
#         }

#         # Restrict access to system files (files starting with a dot)
#         location ~ /\. {
#             deny all;           # Deny access to hidden/system files
#             access_log off;     # Disable logging for these requests
#             log_not_found off;  # Disable logging of "not found" errors for hidden files
#         }
#     }
# }


# events {
#     worker_connections 1024;  # The maximum number of simultaneous connections
# }

# # The main HTTP block
# http {
#     include       /etc/nginx/mime.types;  # Ensure Nginx knows about the types
#     default_type  application/octet-stream;

#     # Disable ETag headers for all responses
#     etag off;

#     # Prevent the site from being framed by any site
#     add_header X-Frame-Options "SAMEORIGIN" always;

#     # Prevent MIME type sniffing
#     add_header X-Content-Type-Options "nosniff" always;

#     # HTTP block (redirects HTTP to HTTPS)
#     server {
#         listen 80;
#         server_name localhost;

#         # Redirect all HTTP traffic to HTTPS
#         return 301 https://$host$request_uri;
#     }

#     # HTTPS block
#     server {
#         listen 443 ssl;
#         server_name localhost;

#         # Path to the SSL certificate and key
#         ssl_certificate /etc/nginx/ssl/certificate.crt;
#         ssl_certificate_key /etc/nginx/ssl/private.key;

#         # SSL configuration for improved security
#         ssl_protocols TLSv1.2 TLSv1.3;
#         ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:EECDH+AESGCM:EDH+AESGCM';
#         ssl_prefer_server_ciphers on;

#         # Set the root directory for the frontend files
#         root /usr/share/nginx/html;

#         # Serve the index file
#         index index.html;

#         autoindex off;

#         # Serve dashboard page
#         location /dashboard_page {
#             try_files $uri $uri/ =404;  # Try to serve the file, return 404 if not found
#         }

#         # Handle other pages like login, profile, etc.
#         location /login_page {
#             try_files $uri $uri/ =404;
#         }

#         location /profile_page {
#             try_files $uri $uri/ =404;
#         }

#         location /transfer_page {
#             try_files $uri $uri/ =404;
#         }

#         # Disable directory listing for /images/ directory
#         location /images/ {
#             autoindex off;  # Prevent file listing
#         }

#         # Restrict access to system files (files starting with a dot)
#         location ~ /\. {
#             deny all;           # Deny access to hidden/system files
#             access_log off;     # Disable logging for these requests
#             log_not_found off;  # Disable logging of "not found" errors for hidden files
#         }
#     }
# }

events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    etag off;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;

    server {
        listen 80;
        server_name localhost;

        return 301 https://$host$request_uri;
    }

    server {
        listen 443 ssl;
        server_name localhost;

        ssl_certificate /etc/nginx/ssl/certificate.crt;
        ssl_certificate_key /etc/nginx/ssl/private.key;
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:EECDH+AESGCM:EDH+AESGCM';
        ssl_prefer_server_ciphers on;

        root /usr/share/nginx/html;
        index index.html;

        autoindex off;

        # Reverse proxy for backend (now using HTTPS)
        location /api/ {
            proxy_pass https://backend:443;  # Changed to HTTPS
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto https;

            # Bypass SSL verification (use only in development)
            proxy_ssl_verify off;
        }

        location /dashboard_page { try_files $uri $uri/ =404; }
        location /login_page { try_files $uri $uri/ =404; }
        location /profile_page { try_files $uri $uri/ =404; }
        location /transfer_page { try_files $uri $uri/ =404; }

        location /images/ { autoindex off; }

        location ~ /\. {
            deny all;
            access_log off;
            log_not_found off;
        }
    }
}

